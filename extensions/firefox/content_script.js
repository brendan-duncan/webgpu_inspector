!function(){const e={CaptureBufferData:'webgpu_inspect_capture_buffer_data',CaptureBuffers:'webgpu_inspect_capture_buffers',DeleteObjects:'webgpu_inspect_delete_objects',ValidationError:'webgpu_inspect_validation_error',MemoryLeakWarning:'webgpu_inspect_memory_leak_warning',DeltaTime:'webgpu_inspect_delta_time',CaptureFrameResults:'webgpu_inspect_capture_frame_results',CaptureFrameCommands:'webgpu_inspect_capture_frame_commands',ObjectSetLabel:'webgpu_inspect_object_set_label',AddObject:'webgpu_inspect_add_object',ResolveAsyncObject:'webgpu_inspect_resolve_async_object',DeleteObject:'webgpu_inspect_delete_object',CaptureTextureFrames:'webgpu_inspect_capture_texture_frames',CaptureTextureData:'webgpu_inspect_capture_texture_data',CaptureBufferData:'webgpu_inspect_capture_buffer_data',WriteBuffer:'wrebgpu_inspect_write_buffer',Recording:'webgpu_record_recording',RecordingCommand:'webgpu_record_command',RecordingDataCount:'webgpu_record_data_count',RecordingData:'webgpu_record_data',PageReady:'webgpu_inspect_page_ready',PanelReady:'webgpu_inspect_panel_ready',ConnectionAck:'webgpu_inspect_connection_ack'};e.values=new Set(Object.values(e));const t='webgpu_inspect_request_texture',s='webgpu_inspect_compile_shader',n='webgpu_inspect_revert_shader',o='webgpu_inspector_capture',i='webgpu_initialize_inspector',r='webgpu_initialize_recorder',a='WEBGPU_INSPECTOR_LOADED',c='WEBGPU_RECORDER_LOADED',_=navigator.userAgent.toLowerCase().indexOf('firefox')>-1,u=new class p{constructor(e,t,s){this.name=e,this.tabId=t??0,this.listeners=[],s&&this.listeners.push(s),this._port=null,this._messageQueue=[],this._isConnected=!1,this._isConnecting=!1,this.reset()}reset(){const e=this;this._isConnected=!1,this._isConnecting=!0;try{this._port=chrome.runtime.connect({name:this.name}),this._port.onDisconnect.addListener(()=>{e._isConnected=!1,e._isConnecting=!1,setTimeout(()=>{e.reset()},100)}),this._port.onMessage.addListener(t=>{if('ConnectionAck'!==t.action)for(const s of e.listeners)try{s(t)}catch(t){console.error(`[WebGPU Inspector] Error in message listener for port ${e.name}:`,t)}else e._handleConnectionAck()}),this._isConnecting=!1,this._isConnected=!0,this._flushMessageQueue()}catch(t){console.error(`[WebGPU Inspector] Failed to connect MessagePort ${this.name}:`,t),this._isConnecting=!1,this._isConnected=!1,setTimeout(()=>{e.reset()},1e3)}}_handleConnectionAck(){this._isConnecting=!1,this._isConnected=!0,this._flushMessageQueue()}_flushMessageQueue(){if(!this._isConnected||0===this._messageQueue.length)return;const e=this._messageQueue.slice();this._messageQueue=[];for(const t of e)this._sendMessage(t)}_sendMessage(e){try{this._port.postMessage(e)}catch(t){console.error(`[WebGPU Inspector] Failed to send message on port ${this.name}:`,t),this._messageQueue.push(e),this._isConnected=!1,this.reset()}}addListener(e){this.listeners.push(e)}postMessage(e){e.__webgpuInspector=!0,this.tabId&&(e.tabId=this.tabId),this._isConnected?this._sendMessage(e):this._messageQueue.push(e)}}('webgpu-inspector-page',0,p=>{let d=p.action;if(!d)return;if(d===e.PanelReady)return void u.postMessage({action:e.ConnectionAck});if(d===t||d===s||d===n){const e=_?cloneInto(p,document.defaultView):p;return void window.dispatchEvent(new CustomEvent('__WebGPUInspector',{detail:e}))}if(d===r)return sessionStorage.setItem(c,`${p.frames}%${p.filename}%${p.download}`),void setTimeout(()=>{window.location.reload()},50);let g='true';if(d===o){const e=JSON.stringify(p);if(p.frame>=0)d=i,g=e;else{sessionStorage.setItem('WEBGPU_INSPECTOR_CAPTURE_FRAME',e);const t={__webgpuInspector:!0,__webgpuInspectorPanel:!0,action:o,data:e},s=_?cloneInto(t,document.defaultView):t;window.dispatchEvent(new CustomEvent('__WebGPUInspector',{detail:s}))}}d===i&&(sessionStorage.setItem(a,g),setTimeout(()=>{window.location.reload()},50))});function d(e,t,s){const n=document.createElement('script');if(n.id=e,n.src=t,s)for(const e in s)n.setAttribute(e,s[e]);(document.head||document.documentElement).appendChild(n)}if(window.addEventListener('pageshow',e=>{e.persisted&&u.reset()}),window.addEventListener('__WebGPUInspector',t=>{const s=t.detail;if('object'!=typeof s||null===s)return;const n=s.action;if(e.values.has(n))try{u.postMessage(s)}catch(e){console.error('[WebGPU Inspector] Error sending message from page:',e)}}),window.addEventListener('__WebGPURecorder',t=>{const s=t.detail;if('object'!=typeof s||null===s)return;const n=s.action;if(e.values.has(n))try{u.postMessage(s)}catch(e){console.error('[WebGPU Inspector] Error sending message from page:',e)}}),-1===navigator.userAgent.indexOf('Chrom')&&(-1!==navigator.userAgent.indexOf('Safari')||-1!==navigator.userAgent.indexOf('Firefox'))){sessionStorage.getItem(a)&&d('__webgpu_inspector',chrome.runtime.getURL('webgpu_inspector_loader.js'));const e=sessionStorage.getItem(c);if(e){const t=e.split('%');d('__webgpu_recorder',chrome.runtime.getURL('webgpu_recorder_loader.js'),{filename:t[1],frames:t[0],download:t[2],removeUnusedResources:1,messageRecording:1})}}u.postMessage({action:e.PageReady})}();
//# sourceMappingURL=content_script.js.map
